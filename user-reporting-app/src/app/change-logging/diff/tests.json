[
  ["empty list, empty docs", {}, [], {}],
  ["empty patch list", { "foo": 1 }, [], { "foo": 1 }],
  ["rearrangements OK?", { "foo": 1, "bar": 2 }, [], { "bar": 2, "foo": 1 }],
  [
    "rearrangements OK?  How about one level down ... array",
    [{ "foo": 1, "bar": 2 }],
    [],
    [{ "bar": 2, "foo": 1 }]
  ],
  [
    "rearrangements OK?  How about one level down...",
    { "foo": { "foo": 1, "bar": 2 } },
    [],
    { "foo": { "bar": 2, "foo": 1 } }
  ],
  [
    "add replaces any existing field",
    { "foo": null },
    [{ "op": "add", "path": "/foo", "value": 1 }],
    { "foo": 1 }
  ],
  [
    "toplevel array",
    [],
    [{ "op": "add", "path": "/0", "value": "foo" }],
    ["foo"]
  ],
  ["toplevel array, no change", ["foo"], [], ["foo"]],
  [
    "toplevel object, numeric string",
    {},
    [{ "op": "add", "path": "/foo", "value": "1" }],
    { "foo": "1" }
  ],
  [
    "toplevel object, integer",
    {},
    [{ "op": "add", "path": "/foo", "value": 1 }],
    { "foo": 1 }
  ],
  [
    "Toplevel scalar values OK?",
    "foo",
    [{ "op": "replace", "path": "", "value": "bar" }],
    "bar"
  ],
  [
    "replace object document with array document?",
    {},
    [{ "op": "add", "path": "", "value": [] }],
    []
  ],
  [
    "replace array document with object document?",
    [],
    [{ "op": "add", "path": "", "value": {} }],
    {}
  ],
  [
    "append to root array document?",
    [],
    [{ "op": "add", "path": "/-", "value": "hi" }],
    ["hi"]
  ],
  ["Add, / target", {}, [{ "op": "add", "path": "/", "value": 1 }], { "": 1 }],
  [
    "Add, /foo/ deep target (trailing slash)",
    { "foo": {} },
    [{ "op": "add", "path": "/foo/", "value": 1 }],
    { "foo": { "": 1 } }
  ],
  [
    "Add composite value at top level",
    { "foo": 1 },
    [{ "op": "add", "path": "/bar", "value": [1, 2] }],
    { "foo": 1, "bar": [1, 2] }
  ],
  [
    "Add into composite value",
    { "foo": 1, "baz": [{ "qux": "hello" }] },
    [{ "op": "add", "path": "/baz/0/foo", "value": "world" }],
    { "foo": 1, "baz": [{ "qux": "hello", "foo": "world" }] }
  ],
  [
    "unnamed test",
    { "foo": 1 },
    [{ "op": "add", "path": "/bar", "value": true }],
    { "foo": 1, "bar": true }
  ],
  [
    "unnamed test",
    { "foo": 1 },
    [{ "op": "add", "path": "/bar", "value": false }],
    { "foo": 1, "bar": false }
  ],
  [
    "unnamed test",
    { "foo": 1 },
    [{ "op": "add", "path": "/bar", "value": null }],
    { "foo": 1, "bar": null }
  ],
  [
    "0 can be an array index or object element name",
    { "foo": 1 },
    [{ "op": "add", "path": "/0", "value": "bar" }],
    { "0": "bar", "foo": 1 }
  ],
  [
    "unnamed test",
    ["foo"],
    [{ "op": "add", "path": "/1", "value": "bar" }],
    ["foo", "bar"]
  ],
  [
    "unnamed test",
    ["foo", "sil"],
    [{ "op": "add", "path": "/1", "value": "bar" }],
    ["foo", "bar", "sil"]
  ],
  [
    "unnamed test",
    ["foo", "sil"],
    [{ "op": "add", "path": "/0", "value": "bar" }],
    ["bar", "foo", "sil"]
  ],
  [
    "push item to array via last index + 1",
    ["foo", "sil"],
    [{ "op": "add", "path": "/2", "value": "bar" }],
    ["foo", "sil", "bar"]
  ],
  [
    "test against implementation-specific numeric parsing",
    { "1e0": "foo" },
    [{ "op": "test", "path": "/1e0", "value": "foo" }],
    { "1e0": "foo" }
  ],
  [
    "value in array add not flattened",
    ["foo", "sil"],
    [{ "op": "add", "path": "/1", "value": ["bar", "baz"] }],
    ["foo", ["bar", "baz"], "sil"]
  ],
  [
    "unnamed test",
    { "foo": 1, "bar": [1, 2, 3, 4] },
    [{ "op": "remove", "path": "/bar" }],
    { "foo": 1 }
  ],
  [
    "unnamed test",
    { "foo": 1, "baz": [{ "qux": "hello" }] },
    [{ "op": "remove", "path": "/baz/0/qux" }],
    { "foo": 1, "baz": [{}] }
  ],
  [
    "unnamed test",
    { "foo": 1, "baz": [{ "qux": "hello" }] },
    [{ "op": "replace", "path": "/foo", "value": [1, 2, 3, 4] }],
    { "foo": [1, 2, 3, 4], "baz": [{ "qux": "hello" }] }
  ],
  [
    "unnamed test",
    { "foo": [1, 2, 3, 4], "baz": [{ "qux": "hello" }] },
    [{ "op": "replace", "path": "/baz/0/qux", "value": "world" }],
    { "foo": [1, 2, 3, 4], "baz": [{ "qux": "world" }] }
  ],
  [
    "unnamed test",
    ["foo"],
    [{ "op": "replace", "path": "/0", "value": "bar" }],
    ["bar"]
  ],
  ["unnamed test", [""], [{ "op": "replace", "path": "/0", "value": 0 }], [0]],
  [
    "unnamed test",
    [""],
    [{ "op": "replace", "path": "/0", "value": true }],
    [true]
  ],
  [
    "unnamed test",
    [""],
    [{ "op": "replace", "path": "/0", "value": false }],
    [false]
  ],
  [
    "unnamed test",
    [""],
    [{ "op": "replace", "path": "/0", "value": null }],
    [null]
  ],
  [
    "value in array replace not flattened",
    ["foo", "sil"],
    [{ "op": "replace", "path": "/1", "value": ["bar", "baz"] }],
    ["foo", ["bar", "baz"]]
  ],
  [
    "replace whole document",
    { "foo": "bar" },
    [{ "op": "replace", "path": "", "value": { "baz": "qux" } }],
    { "baz": "qux" }
  ],
  [
    "spurious patch properties",
    { "foo": 1 },
    [{ "op": "test", "path": "/foo", "value": 1, "spurious": 1 }],
    { "foo": 1 }
  ],
  [
    "null value should be valid obj property",
    { "foo": null },
    [{ "op": "test", "path": "/foo", "value": null }],
    { "foo": null }
  ],
  [
    "null value should be valid obj property to be replaced with something truthy",
    { "foo": null },
    [{ "op": "replace", "path": "/foo", "value": "truthy" }],
    { "foo": "truthy" }
  ],
  [
    "null value should be valid obj property to be moved",
    { "foo": null },
    [{ "op": "move", "from": "/foo", "path": "/bar" }],
    { "bar": null }
  ],
  [
    "null value should be valid obj property to be copied",
    { "foo": null },
    [{ "op": "copy", "from": "/foo", "path": "/bar" }],
    { "foo": null, "bar": null }
  ],
  [
    "null value should be valid obj property to be removed",
    { "foo": null },
    [{ "op": "remove", "path": "/foo" }],
    {}
  ],
  [
    "null value should still be valid obj property replace other value",
    { "foo": "bar" },
    [{ "op": "replace", "path": "/foo", "value": null }],
    { "foo": null }
  ],
  [
    "test should pass despite rearrangement",
    { "foo": { "foo": 1, "bar": 2 } },
    [{ "op": "test", "path": "/foo", "value": { "bar": 2, "foo": 1 } }],
    { "foo": { "foo": 1, "bar": 2 } }
  ],
  [
    "test should pass despite (nested) rearrangement",
    { "foo": [{ "foo": 1, "bar": 2 }] },
    [{ "op": "test", "path": "/foo", "value": [{ "bar": 2, "foo": 1 }] }],
    { "foo": [{ "foo": 1, "bar": 2 }] }
  ],
  [
    "test should pass - no error",
    { "foo": { "bar": [1, 2, 5, 4] } },
    [{ "op": "test", "path": "/foo", "value": { "bar": [1, 2, 5, 4] } }],
    { "foo": { "bar": [1, 2, 5, 4] } }
  ],
  [
    "Empty-string element",
    { "": 1 },
    [{ "op": "test", "path": "/", "value": 1 }],
    { "": 1 }
  ],
  [
    "unnamed test",
    {
      "foo": ["bar", "baz"],
      "": 0,
      "a/b": 1,
      "c%d": 2,
      "e^f": 3,
      "g|h": 4,
      "i\\j": 5,
      "k\"l": 6,
      " ": 7,
      "m~n": 8
    },
    [
      { "op": "test", "path": "/foo", "value": ["bar", "baz"] },
      { "op": "test", "path": "/foo/0", "value": "bar" },
      { "op": "test", "path": "/", "value": 0 },
      { "op": "test", "path": "/a~1b", "value": 1 },
      { "op": "test", "path": "/c%d", "value": 2 },
      { "op": "test", "path": "/e^f", "value": 3 },
      { "op": "test", "path": "/g|h", "value": 4 },
      { "op": "test", "path": "/i\\j", "value": 5 },
      { "op": "test", "path": "/k\"l", "value": 6 },
      { "op": "test", "path": "/ ", "value": 7 },
      { "op": "test", "path": "/m~0n", "value": 8 }
    ],
    {
      "": 0,
      " ": 7,
      "a/b": 1,
      "c%d": 2,
      "e^f": 3,
      "foo": ["bar", "baz"],
      "g|h": 4,
      "i\\j": 5,
      "k\"l": 6,
      "m~n": 8
    }
  ],
  [
    "Move to same location has no effect",
    { "foo": 1 },
    [{ "op": "move", "from": "/foo", "path": "/foo" }],
    { "foo": 1 }
  ],
  [
    "unnamed test",
    { "foo": 1, "baz": [{ "qux": "hello" }] },
    [{ "op": "move", "from": "/foo", "path": "/bar" }],
    { "baz": [{ "qux": "hello" }], "bar": 1 }
  ],
  [
    "unnamed test",
    { "baz": [{ "qux": "hello" }], "bar": 1 },
    [{ "op": "move", "from": "/baz/0/qux", "path": "/baz/1" }],
    { "baz": [{}, "hello"], "bar": 1 }
  ],
  [
    "unnamed test",
    { "baz": [{ "qux": "hello" }], "bar": 1 },
    [{ "op": "copy", "from": "/baz/0", "path": "/boo" }],
    { "baz": [{ "qux": "hello" }], "bar": 1, "boo": { "qux": "hello" } }
  ],
  [
    "replacing the root of the document is possible with add",
    { "foo": "bar" },
    [{ "op": "add", "path": "", "value": { "baz": "qux" } }],
    { "baz": "qux" }
  ],
  [
    "Adding to \"/-\" adds to the end of the array",
    [1, 2],
    [{ "op": "add", "path": "/-", "value": { "foo": ["bar", "baz"] } }],
    [1, 2, { "foo": ["bar", "baz"] }]
  ],
  [
    "Adding to \"/-\" adds to the end of the array, even n levels down",
    [1, 2, [3, [4, 5]]],
    [{ "op": "add", "path": "/2/1/-", "value": { "foo": ["bar", "baz"] } }],
    [1, 2, [3, [4, 5, { "foo": ["bar", "baz"] }]]]
  ],
  [
    "test remove on array",
    [1, 2, 3, 4],
    [{ "op": "remove", "path": "/0" }],
    [2, 3, 4]
  ],
  [
    "test repeated removes",
    [1, 2, 3, 4],
    [
      { "op": "remove", "path": "/1" },
      { "op": "remove", "path": "/2" }
    ],
    [1, 3]
  ],
  [
    "Patch with different capitalisation than doc",
    { "foo": "bar" },
    [{ "op": "add", "path": "/FOO", "value": "BAR" }],
    { "foo": "bar", "FOO": "BAR" }
  ],
  [
    "test copy object then change destination",
    { "foo": { "bar": { "baz": [{ "boo": "net" }] } } },
    [
      { "op": "copy", "from": "/foo", "path": "/bak" },
      { "op": "replace", "path": "/bak/bar/baz/0/boo", "value": "qux" }
    ],
    {
      "foo": { "bar": { "baz": [{ "boo": "net" }] } },
      "bak": { "bar": { "baz": [{ "boo": "qux" }] } }
    }
  ],
  [
    "test copy object then change source",
    { "foo": { "bar": { "baz": [{ "boo": "net" }] } } },
    [
      { "op": "copy", "from": "/foo", "path": "/bak" },
      { "op": "replace", "path": "/foo/bar/baz/0/boo", "value": "qux" }
    ],
    {
      "foo": { "bar": { "baz": [{ "boo": "qux" }] } },
      "bak": { "bar": { "baz": [{ "boo": "net" }] } }
    }
  ]
]
